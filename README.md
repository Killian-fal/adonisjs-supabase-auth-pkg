# AdonisJS Supabase authorization

This package lets you automatically integrate supabase to turn your adonis api into a “resource server”.
The api will only verify the token provided by the client, authentication will have to be done beforehand by the webapp or application.
Many articles talk about the difference between **authentication** and **authorization**, e.g. [this article](https://www.okta.com/identity-101/authentication-vs-authorization/#:~:text=What's%20the%20difference%20between%20authentication,permission%20to%20access%20a%20resource.)

This package generates only the files needed for the api to manage **authorization**

## Installation

This package **installs only the dependencies and generates only the files required for supabase integration**. It can be removed from `package.json` once configuration is complete.
If you don't want to use this package and do the installation yourself, you'll find a guide [here](MANUAL.md)

Otherwise, you can install the package in your project

```sh
node ace add @killian-fal/adonisjs-supabase-auth
```

or with npm:

```sh
npm i @killian-fal/adonisjs-supabase-auth
node ace configure @killian-fal/adonisjs-supabase-auth
```

## Usage

To protect a route, simply use the authentication middleware:
```ts
import { middleware } from './kernel.js'

[...]

router
  .get([...])
  .use(middleware.auth()) // here
```

or:
```ts
router
  .group(() => {[...]})
  .use([middleware.auth()])
```

Then, it is possible to get the user:
```ts
async foo({ auth }: HttpContext) {
  const user = auth.getUserOrFail() // type: CustomSupabaseUser defined in the guard
  // your logic here
}
```

## Samples

A list of examples is available [here](samples/) to show the possible implementations/modifications of the classes generated by the package. They also show how to test the application with a supabase mock

1. **classic:** unmodified version of the package with tests
2. **with-custom-details:** modified version of the package with user details, more information [here](https://supabase.com/docs/guides/auth/auth-hooks)
3. **with-internal-profile:** modified version of the package with an internal profile (stored in a sqlite database)
4. **with-both-and-role-based:** version combining the above 2 samples, adding a decorator to build a role access based application

## License
This project is Open Source software released under the [MIT license.](LICENSE.md)